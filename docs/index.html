<!DOCTYPE html>
<html>
<head>
    <title>Neuron Playground</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #f0f0f0;
        }
        canvas {
            display: block;
        }
    </style>
  <script type="module" crossorigin="">import{passAlongProps as P,html as b}from"https://esm.sh/gh/jeff-hykin/elemental@0.6.5/main/deno.js";(function(){let e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(let t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(let n of t)if(n.type==="childList")for(let r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(t){let n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;let n=s(t);fetch(t.href,n)}})();const k={red:"#E06C75",blue:"#61AFEF",orange:"#D19A66",yellow:"#E5C07B",purple:"#C678DD",green:"#04d895",white:"#f5f5f5",black:"#383838",gray:"#666666"};function w(o,e){o=o.replace(/^#/,"");let s=parseInt(o.substring(0,2),16),i=parseInt(o.substring(2,4),16),t=parseInt(o.substring(4,6),16);return s=Math.min(255,Math.floor(s+(255-s)*e)),i=Math.min(255,Math.floor(i+(255-i)*e)),t=Math.min(255,Math.floor(t+(255-t)*e)),`#${((1<<24)+(s<<16)+(i<<8)+t).toString(16).slice(1).toUpperCase()}`}function m(o,e,s){o=o.replace(/^#/,""),e=e.replace(/^#/,"");const i=parseInt(o.substring(0,2),16),t=parseInt(o.substring(2,4),16),n=parseInt(o.substring(4,6),16),r=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),d=parseInt(e.substring(4,6),16),l=Math.round(i+s*(r-i)),u=Math.round(t+s*(a-t)),f=Math.round(n+s*(d-n));return`#${((1<<24)+(l<<16)+(u<<8)+f).toString(16).slice(1).toUpperCase()}`}const{red:g,blue:h,orange:L,yellow:F,purple:O,green:I,white:W,black:p,gray:E}=k;function v(o){const e=Math.max(0,Math.min(1,o/.9));return m(h,g,e)}function D(o,e,s){const i=(e.x-s.x)**2+(e.y-s.y)**2;if(i===0)return Math.hypot(o.x-e.x,o.y-e.y);let t=((o.x-e.x)*(s.x-e.x)+(o.y-e.y)*(s.y-e.y))/i;t=Math.max(0,Math.min(1,t));const n={x:e.x+t*(s.x-e.x),y:e.y+t*(s.y-e.y)};return Math.hypot(o.x-n.x,o.y-n.y)}function N({ctx:o,x:e,y:s,angle:i,size:t,thickness:n,color:r=p}){o.beginPath(),o.moveTo(e,s),o.lineTo(e-t*Math.cos(i-Math.PI/6),s-t*Math.sin(i-Math.PI/6)),o.lineTo(e-t*Math.cos(i+Math.PI/6),s-t*Math.sin(i+Math.PI/6)),o.lineTo(e,s),o.closePath(),o.strokeStyle=r,o.fillStyle=r,o.lineWidth=n,o.fill(),o.stroke()}function c(o){return o<=0?m(g,h,(o+1)**2/1):m(I,h,1-Math.min(o,1))}class C{constructor(){this.nodes=new Map,this.edges=new Map,this.selectedNode=null,this.draggingNode=null,this.edgeStartNode=null,this.offset={x:0,y:0},this.scale=1,this.nodeRadius=25,this.edgeStrength=1,this.isDragging=!1,this.dragStartPos=null,this.isPanning=!1,this.panStartPos=null,this.edgeThickness=5,this.dragThreshold=5,this.scaleMin=.1,this.scaleMax=5,this.scaleFactorIncrease=1.1,this.scaleFactorDecrease=.9,this.pulseDuration=200,this.strokeStyleEdge=E,this.strokeStyleNormal=p,this.strokeStylePulse=w(g,.3),this.strokeStyleEdgeCreation=h,this.strokeWidthNormal=2,this.strokeWidthPulse=4,this.mouseDownInfo=null,this.lastHoveredNodeId=null,this.arrowLength=15,this.arrowWidth=8,this.normalColor=p,this.strokeStyleIncomingEdge=g,this.strokeStyleOutgoingEdge=h,this.internalParameters={selfEdgeStartAngle:-2.807285748448284,selfEdgeEndAngle:1.7585218457865455},this.element=document.createElement("canvas"),this.ctx=this.element.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.element.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.element.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.element.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.element.addEventListener("wheel",this.handleWheel.bind(this)),this.element.addEventListener("contextmenu",this.handleContextMenu.bind(this)),this.animate()}resizeCanvas(){this.element.width=window.innerWidth,this.element.height=window.innerHeight}handleMouseDown(e){const s=e.shiftKey,i=e.button===2,t=this.getMousePos(e),n=this.findNodeIdAtPosition(t),r=this.findEdgeAtPosition(t);if(this.mouseDownInfo={shiftWasPressed:s,isRightClick:i,pos:t,hoveredNodeId:n,hoveredEdgeId:r},!i)if(n)e.shiftKey?this.edgeStartNode===null?this.edgeStartNode=n:(this.createEdge(this.edgeStartNode,n),this.edgeStartNode=null):(this.draggingNode=n,this.isDragging=!1,this.dragStartPos=t);else if(r){const a=this.edges.get(r),d=parseFloat(globalThis.prompt(`Edge weight: ${a.strength}
Press okay to acknowledge, or enter replacement value`));d-0===d&&(a.strength=d)}else this.isPanning=!0,this.panStartPos={x:e.clientX,y:e.clientY}}handleMouseMove(e){const s=this.getMousePos(e),i=this.findNodeIdAtPosition(s);if(this.lastHoveredNodeId=i||this.lastHoveredNodeId,this.draggingNode){if(!this.isDragging){const t=s.x-this.dragStartPos.x,n=s.y-this.dragStartPos.y;t*t+n*n>this.dragThreshold&&(this.isDragging=!0)}if(this.isDragging){const t=this.nodes.get(this.draggingNode);t.x=s.x,t.y=s.y}}else if(this.isPanning){const t=e.clientX-this.panStartPos.x,n=e.clientY-this.panStartPos.y;this.offset.x+=t,this.offset.y+=n,this.panStartPos={x:e.clientX,y:e.clientY},this.draw()}}handleMouseUp(e){const s=this.mouseDownInfo;if(this.mouseDownInfo=null,!this.isDragging&&s&&s.hoveredNodeId&&!s.shiftWasPressed){const t=s.hoveredNodeId,n=this.nodes.get(t);this.manuallyFireNode(n)}this.draggingNode=null,this.isDragging=!1,this.isPanning=!1,this.dragStartPos=null,this.panStartPos=null}handleWheel(e){e.preventDefault();const i=e.deltaY>0?this.scaleFactorDecrease:this.scaleFactorIncrease;this.scale*=i,this.scale=Math.max(this.scaleMin,Math.min(this.scaleMax,this.scale))}handleContextMenu(e){e.preventDefault();const s=this.getMousePos(e);this.createNode(s.x,s.y)}getMousePos(e){const s=this.element.getBoundingClientRect();return{x:(e.clientX-s.left-this.offset.x)/this.scale,y:(e.clientY-s.top-this.offset.y)/this.scale}}createNode(e,s){const i=Date.now().toString();return this.nodes.set(i,{x:e,y:s,id:i,pulse:!1,spikeThreshold:1,energy:.1,energyDecayRate:.1,isFiringNext:!1,stableEnergyLevel:.1,energyAfterFiring:0,radius:this.nodeRadius}),i}createEdge(e,s,i=1){const t=`${e}-${s}`;return this.edges.set(t,{from:e,to:s,strength:i}),t}findNodeIdAtPosition(e){for(const[s,i]of this.nodes){const t=e.x-i.x,n=e.y-i.y;if(t*t+n*n<=this.nodeRadius*this.nodeRadius)return s}return null}findEdgeAtPosition(e){const s=this.edgeThickness*1.3;for(const[i,t]of this.edges){const n=this.nodes.get(t.from),r=this.nodes.get(t.to);if(t.from===t.to){const a=this.nodes.get(t.from),d=a.x+this.nodeRadius,l=a.y-this.nodeRadius,u=this.nodeRadius,f=this.internalParameters.selfEdgeStartAngle,S=this.internalParameters.selfEdgeEndAngle,x=Math.atan2(e.y-l,e.x-d);if(x>=f&&x<=S){const M=Math.hypot(e.x-d,e.y-l);if(Math.abs(M-u)<s)return i}}else if(D(e,{x:n.x,y:n.y},{x:r.x,y:r.y})<s)return i}return null}manuallyFireNode(e){e.energy=e.spikeThreshold,e.isFiringNext=!0,this.pulseNode(e)}draw(){if(this.ctx.clearRect(0,0,this.element.width,this.element.height),this.ctx.save(),this.ctx.translate(this.offset.x,this.offset.y),this.ctx.scale(this.scale,this.scale),this.lastHoveredNodeId)for(const e of this.edges.values()){const s=this.nodes.get(e.from),i=this.nodes.get(e.to);if(e.from===e.to){if(this.lastHoveredNodeId===e.from){this.ctx.beginPath();const t=this.nodes.get(e.from),[n,r]=[t.x+this.nodeRadius,t.y-this.nodeRadius];this.ctx.arc(n,r,this.nodeRadius,this.internalParameters.selfEdgeStartAngle,this.internalParameters.selfEdgeEndAngle),this.ctx.lineWidth=this.edgeThickness,this.ctx.strokeStyle=c(e.strength),this.ctx.stroke(),N({ctx:this.ctx,x:t.x+this.nodeRadius*.5,y:t.y-this.nodeRadius*1.55,angle:-.4+Math.PI*2,size:this.arrowLength,thickness:this.edgeThickness*.5,color:c(e.strength)})}}else if(e.from===this.lastHoveredNodeId||e.to===this.lastHoveredNodeId){this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(i.x,i.y),this.ctx.strokeStyle=c(e.strength),this.ctx.lineWidth=this.edgeThickness,this.ctx.stroke();const t=Math.atan2(i.y-s.y,i.x-s.x),n=i.x-this.nodeRadius*1.1*Math.cos(t),r=i.y-this.nodeRadius*1.1*Math.sin(t);N({ctx:this.ctx,x:n,y:r,angle:t,size:this.arrowLength,thickness:this.edgeThickness,color:c(e.strength)})}}for(const[e,s]of this.nodes)this.ctx.beginPath(),this.ctx.arc(s.x,s.y,s.radius,0,Math.PI*2),this.ctx.fillStyle=v(s.energy),this.ctx.fill(),e===this.edgeStartNode?this.ctx.strokeStyle=this.strokeStyleEdgeCreation:s.pulse?this.ctx.strokeStyle=this.strokeStylePulse:this.ctx.strokeStyle=this.strokeStyleNormal,this.ctx.lineWidth=s.pulse?this.strokeWidthPulse:this.strokeWidthNormal,this.ctx.stroke();this.ctx.restore()}animate(){this.draw(),requestAnimationFrame(()=>this.animate())}saveToJSON(){return JSON.stringify({nodes:Array.from(this.nodes.entries()),edges:Array.from(this.edges.entries())})}loadFromJSON(e){const s=JSON.parse(e);this.nodes=new Map(s.nodes),this.edges=new Map(s.edges)}load(e){this.nodes.clear(),this.edges.clear();for(const[s,i]of e.nodes)this.nodes.set(s,i);for(const[s,i]of e.edges)this.edges.set(s,i)}pulseNode(e){e.isPulsing||(e.isPulsing=!0,e.pulse=!0,setTimeout(()=>{e.pulse=!1,e.isPulsing=!1},this.pulseDuration))}next(){const e=Array.from(this.nodes.values()),s={};for(let i of e)if(i.isFiringNext){for(const t of this.edges.values())if(t.from===i.id){const n=this.nodes.get(t.to);n&&(s[n.id]=s[n.id]||0,s[n.id]+=t.strength)}}for(let i of e)i.isFiringNext&&(i.energy=i.energyAfterFiring,i.isFiringNext=!1,this.pulseNode(i));for(const[i,t]of Object.entries(s)){const n=this.nodes.get(i);n&&(n.energy+=t)}for(let i of e)i.energy>=i.spikeThreshold&&(i.isFiringNext=!0);for(let i of e)i.isFiringNext||(i.energy-=i.energyDecayRate,i.energy<i.stableEnergyLevel&&(i.energy=i.stableEnergyLevel));this.draw()}}function y({...o}){const e=document.createElement("button");return e.style.padding="8px 16px",e.style.backgroundColor="#0066ff",e.style.color="white",e.style.border="none",e.style.borderRadius="4px",e.style.cursor="pointer",P(e,o),e}function A(o){const e=o.saveToJSON(),s=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(s),t=document.createElement("a");t.href=i,t.download=`canvas-state-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(i)}function T(o){const e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=s=>{const i=s.target.files[0];if(i){const t=new FileReader;t.onload=n=>{const r=JSON.parse(n.target.result);o.load(r)},t.readAsText(i)}},e.click()}window.addEventListener("load",()=>{const o=new C;document.body=b`<body style="margin: 0; overflow: hidden; background: #f0f0f0;">
        ${o.element}
        <div style="position: fixed; top: 20px; right: 20px; gap: 2rem; display: flex;">
            ${y({children:"Save",onClick:()=>A(o)})}
            ${y({children:"Load",onClick:()=>T(o)})}
            ${y({children:"Next",onClick:()=>o.next()})}
        </div>
    </body>`});
</script>
</head>
<body>
    <div style="display: flex;justify-content: center;align-items: center;height: 100vh;">
        <div style="width: 50px;height: 50px;border: 10px solid #dddddd;border-top-color: #009579;border-radius: 50%;transform: rotate(0.16turn);" id="good-component--initial-loader">
        </div>
    </div>

<script>
    const animateLoader = ()=>{
        const element = document.getElementById("good-component--initial-loader")
        element && element.animate(
            [
                { transform: 'rotate(0turn)' },
                { transform: 'rotate(1turn)' },
            ],
            {
                duration: 1000,
                iterations: Infinity,
                easing: 'ease',
            },
        )
    }
    document.body ? animateLoader() : document.addEventListener("DOMContentLoaded", animateLoader)
</script>
</body>
</html>